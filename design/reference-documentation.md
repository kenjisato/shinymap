# Reference Documentation Strategy

**Status**: IMPLEMENTED (v0.3.0)
**Created**: 2025-12-28

> **Note**: This document is kept for historical reference. The documentation
> infrastructure (Quarto, quartodoc, typedoc) is fully implemented and working.
> Use `make docs` to build, `make docs-preview` to preview locally.

## Overview

This document outlines the strategy for creating a unified reference documentation site for shinymap, covering both the Python and TypeScript APIs.

## Goals

1. **Automated API documentation** from source code (docstrings, JSDoc)
2. **Testable examples** in docstrings via doctest
3. **Unified documentation site** combining Python and TypeScript APIs
4. **Easy maintenance** with CI/CD integration

## Tooling

### Python Documentation

**Tool**: [quartodoc](https://machow.github.io/quartodoc/)

- Generates API reference from Python docstrings
- Native Quarto integration
- Supports cross-references and type annotations

### TypeScript Documentation

**Tool**: [typedoc](https://typedoc.org/)

- Generates API reference from TypeScript/JSDoc comments
- Output as Markdown for Quarto integration
- Use `typedoc-plugin-markdown` for Quarto-compatible output

### Unified Site

**Framework**: [Quarto](https://quarto.org/)

- Combines Python and TypeScript documentation
- Supports multiple output formats
- Built-in search functionality (sufficient for project needs)
- Extensible with custom pages

## Build Commands

| Command | Purpose |
|---------|---------|
| `make docs` | Build full documentation site |
| `make docs-python` | Generate Python API docs (quartodoc) |
| `make docs-typescript` | Generate TypeScript API docs (typedoc) |
| `make docs-preview` | Preview documentation site locally |

## File Structure

```
docs/
├── _quarto.yml              # Quarto configuration + quartodoc config
├── index.qmd                # Landing page
├── python/                  # [generated] quartodoc output - DO NOT EDIT
├── typescript/              # [generated] typedoc output - DO NOT EDIT
└── vignettes/               # [hand-written] Tutorials and use cases
    ├── index.qmd            # Vignettes listing
    ├── getting-started.qmd  # Tutorial: first steps
    ├── modes.qmd            # Tutorial: selection modes
    ├── aesthetics.qmd       # Tutorial: styling
    └── images/              # Images for vignettes
        └── *.png
```

### Directory Rules

| Directory | Source | Tracked in Git | Notes |
|-----------|--------|----------------|-------|
| `python/` | Generated by quartodoc | No | Auto-generated from docstrings |
| `typescript/` | Generated by typedoc | No | Auto-generated from JSDoc |
| `vignettes/` | Hand-written | Yes | Tutorials, use cases, guides |
| `vignettes/images/` | Hand-written | Yes | Assets for vignettes |
| `_site/` | Generated by Quarto | No | Final build output |
| `.quarto/` | Quarto cache | No | Build cache |

### Vignette Naming Convention

- Use kebab-case: `getting-started.qmd`, `custom-geometry.qmd`
- Keep names descriptive but concise
- Group related images in `images/` with matching prefix: `images/getting-started-*.png`

## Implementation Phases

### Phase 1: Python Doctest Infrastructure ✅ COMPLETE

**Status**: ~~Partially working (41 pass, 41 fail)~~ Fixed in v0.3.0

**Original issues** (all resolved):
1. Comments in expected output cause failures
2. File I/O examples reference non-existent files
3. Formatting mismatches

**Actions**:
1. Fix doctest examples in source code
2. Add `--doctest-modules` to pytest configuration
3. Create test fixtures for file I/O examples

### Phase 2: Quartodoc Setup ✅ COMPLETE

1. Install quartodoc: `uv add quartodoc --dev`
2. Create `docs/_quarto.yml` with quartodoc configuration
3. Configure API reference generation
4. Test local build

### Phase 3: TypeDoc Setup ✅ COMPLETE

1. Install typedoc: `npm install typedoc typedoc-plugin-markdown --save-dev`
2. Configure `typedoc.json` for Markdown output
3. Generate to `docs/typescript/reference/`
4. Integrate with Quarto site

### Phase 4: CI/CD Integration ✅ COMPLETE

1. GitHub Actions workflow for documentation build
2. Deploy to GitHub Pages on push to `main`
3. Preview builds for PRs (optional)

## Decisions

### Version Management

**Decision**: Two documentation versions (release + dev)

| Branch | URL | Description |
|--------|-----|-------------|
| `main` | `https://<user>.github.io/shinymap/` | Release documentation |
| `dev` | `https://<user>.github.io/shinymap/dev/` | Development documentation |

The `main` branch docs are deployed to the root of GitHub Pages (stable release).
The `dev` branch docs are deployed to the `/dev/` subdirectory (latest development).

After reaching 1.0.0, consider adding versioned documentation (e.g., `/v1.0/`, `/v1.1/`).

### Search

**Decision**: Use Quarto built-in search

Quarto's built-in search is sufficient for the project's scale. No need for external search services.

### Examples Gallery

**Decision**: Defer (requires backend server)

Interactive examples would enhance documentation but require a Shiny server backend. Prioritize this after core documentation is stable.

### Hosting

**Decision**: GitHub Pages

Simple, free, and integrates well with GitHub Actions. No additional infrastructure needed.

## Doctest Best Practices

For doctests to pass reliably:

```python
def example_function(x: int) -> int:
    """Short description.

    Examples
    --------
    >>> example_function(5)
    10
    >>> example_function(0)
    0

    """
    return x * 2
```

**Rules**:
1. No inline comments in expected output
2. Use `# doctest: +SKIP` for examples that can't be tested
3. Use `# doctest: +ELLIPSIS` for variable output
4. Create fixtures for file I/O examples in `conftest.py`

## Related Files

- `packages/shinymap/python/pyproject.toml` - pytest doctest configuration
- `packages/shinymap/js/package.json` - typedoc script
- `packages/shinymap/js/typedoc.json` - typedoc configuration
- `docs/_quarto.yml` - Quarto site + quartodoc configuration
- `.github/workflows/docs.yml` - GitHub Actions deployment workflow
